var S=Object.defineProperty;var A=(a,t,e)=>t in a?S(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var y=(a,t,e)=>A(a,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();var k={};let p=null,v=null;const E=()=>typeof process<"u"&&(k.VITEST==="true"||typeof globalThis.describe=="function"),b=()=>({memory:new WebAssembly.Memory({initial:1}),__wbg_set_wasm:()=>{},__wbindgen_export_0:()=>{},__wbindgen_export_1:()=>{},default:async()=>{console.log("Mock WASM module initialized for tests")}});async function M(){if(!p){if(v){await v;return}v=(async()=>{var a;try{if(E()){console.log("Loading mock WASM module for test environment"),p=b();return}typeof window<"u"?(console.warn("WASM loading in browser not yet configured"),p=b()):typeof process<"u"&&((a=process.versions)!=null&&a.node)?(console.warn("WASM loading in Node.js not yet configured"),p=b()):(console.warn("WASM loading not yet configured"),p=b())}catch(t){if(E())console.warn("WASM loading failed in test environment, using mock:",t.message),p=b();else throw console.error("Failed to load WASM module:",t),t}})(),await v}}class d{constructor(t){y(this,"source");y(this,"operators",[]);y(this,"errorHandler");y(this,"terminateOnError",!1);y(this,"_originalArraySource");Array.isArray(t)?(this.source=t,this._originalArraySource=t):this.source=t}observe(t,e){const n=new AbortController,r=e==null?void 0:e.signal;let o=!0;const s=()=>{o=!1,n.abort()},i={unsubscribe:s,get isActive(){return o},[Symbol.dispose]:s,[Symbol.asyncDispose]:async()=>s()};return(async()=>{var u;try{for await(const c of this){if(!o||r!=null&&r.aborted||n.signal.aborted)break;try{const m=this.applyOperators(c),g=m instanceof Promise?await m:m;g!==void 0&&t(g)}catch(m){if(e!=null&&e.onError&&e.onError(m),this.terminateOnError)break}}o&&!(r!=null&&r.aborted)&&((u=e==null?void 0:e.onComplete)==null||u.call(e))}catch(c){e!=null&&e.onError&&e.onError(c)}finally{o=!1}})(),i}applyOperators(t){let e=t;for(const n of this.operators){if(e===void 0)break;try{const r=n(e);if(r instanceof Promise)return this.applyOperatorsAsync(t);e=r}catch(r){if(this.errorHandler){if(e=this.errorHandler(r),e!==void 0)break}else{if(this.terminateOnError)throw r;e=void 0;break}}}return e}async applyOperatorsAsync(t){let e=t;for(const n of this.operators){if(e===void 0)break;try{const r=n(e);e=r instanceof Promise?await r:r}catch(r){if(this.errorHandler){if(e=this.errorHandler(r),e!==void 0)break}else{if(this.terminateOnError)throw r;e=void 0;break}}}return e}async*asyncFallback(t){for(const e of t){const n=this.applyOperators(e),r=n instanceof Promise?await n:n;r!==void 0&&(yield r)}}map(t){const e=new d(this);return e.operators=[...this.operators,t],e.errorHandler=this.errorHandler,e.terminateOnError=this.terminateOnError,e._originalArraySource=this._originalArraySource,e}filter(t){const e=new d(this),n=r=>{const o=t(r);return o instanceof Promise?o.then(s=>s?r:void 0):o?r:void 0};return e.operators=[...this.operators,n],e.errorHandler=this.errorHandler,e.terminateOnError=this.terminateOnError,e._originalArraySource=this._originalArraySource,e}scan(t,e){let n=e;return this.map(async r=>{const o=t(n,r);return n=o instanceof Promise?await o:o,n})}take(t){let e=0;return this.filter(()=>e++<t)}skip(t){let e=0;return this.filter(()=>++e>t)}fork(t){const e=this.filter(t),n=this.filter(r=>!t(r));return[e,n]}merge(...t){const e=[this,...t],n=async function*(){const r=e.map(s=>s[Symbol.asyncIterator]());let o=new Map;for(let s=0;s<r.length;s++)o.set(s,r[s].next().then(i=>({i:s,r:i})));for(;o.size>0;){const{i:s,r:i}=await Promise.race(o.values());i.done?o.delete(s):(yield i.value,o.set(s,r[s].next().then(u=>({i:s,r:u}))))}};return new d(n())}rescue(t){const e=new d(this);return e.operators=[...this.operators],e.errorHandler=t,e.terminateOnError=this.terminateOnError,e}terminateOnErrorMode(){const t=new d(this);return t.terminateOnError=!0,t}async mapWasm(t,e){await M();const n=new d(this);return n.operators.push(r=>{if(!p)throw new Error("WASM module not loaded");return r instanceof Float32Array?p.process_float32_batch(r,t):r}),n}windowedAggregate(t,e){let n=[];const r=this,o=async function*(){for await(const s of r){if(typeof s!="number")throw new Error("windowedAggregate requires numeric values");if(n.push(s),n.length===t){let i;switch(e){case"mean":i=n.reduce((u,c)=>u+c,0)/n.length;break;case"sum":i=n.reduce((u,c)=>u+c,0);break;case"max":i=Math.max(...n);break;case"min":i=Math.min(...n);break;default:throw new Error(`Unknown operation: ${e}`)}yield i,n.shift()}}};return new d(o())}toReadableStream(){const t=this[Symbol.asyncIterator]();return new ReadableStream({async pull(e){const{value:n,done:r}=await t.next();r?e.close():e.enqueue(n)}})}static fromReadableStream(t){return new d(t)}static from(t){if(t instanceof Promise){const e=async function*(){yield await t};return new d(e())}return new d(t)}static empty(){return new d([])}static of(...t){return new d(t)}async*[Symbol.asyncIterator](){if(this.source instanceof d){this.errorHandler&&!this.source.errorHandler&&(this.source.errorHandler=this.errorHandler,this.source.terminateOnError=this.terminateOnError);for await(const t of this.source){const e=this.applyOperators(t),n=e instanceof Promise?await e:e;n!==void 0&&(yield n)}}else if(this.source instanceof ReadableStream){const t=this.source.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)break;const r=this.applyOperators(n),o=r instanceof Promise?await r:r;o!==void 0&&(yield o)}}finally{t.releaseLock()}}else if(typeof this.source=="function"){const t=this.source();for await(const e of t){const n=this.applyOperators(e),r=n instanceof Promise?await n:n;r!==void 0&&(yield r)}}else if(Symbol.asyncIterator in this.source)for await(const t of this.source){const e=this.applyOperators(t),n=e instanceof Promise?await e:e;n!==void 0&&(yield n)}else if(Symbol.iterator in this.source){if(Array.isArray(this.source)&&this.operators.length>0)try{for(const t of this.source){let e=t;for(const n of this.operators){if(e===void 0)break;const r=n(e);if(r instanceof Promise){yield*this.asyncFallback(this.source.slice(this.source.indexOf(t)));return}e=r}e!==void 0&&(yield e)}return}catch{}for(const t of this.source){const e=this.applyOperators(t),n=e instanceof Promise?await e:e;n!==void 0&&(yield n)}}}async toArray(){if(this._originalArraySource&&this.operators.length===2&&this._originalArraySource.length>0)try{const e=this.operators[0],n=this.operators[1],r=e(this._originalArraySource[0]);if(r instanceof Promise)throw new Error("async");if(n(r)instanceof Promise)throw new Error("async");const s=[],i=this._originalArraySource,u=i.length;s.length=0;for(let c=0;c<u;c++){const m=i[c],g=e(m);n(g)!==void 0&&(s[s.length]=g)}return s}catch{}if(this._originalArraySource&&this.operators.length>0&&this._originalArraySource.length>0)try{let e=this._originalArraySource;for(const n of this.operators){const r=[];for(let o=0;o<e.length;o++){const s=n(e[o]);if(s instanceof Promise)throw new Error("async");s!==void 0&&r.push(s)}e=r}return e}catch{}const t=[];for await(const e of this)t.push(e);return t}async first(){for await(const t of this)return t}async last(){let t;for await(const e of this)t=e;return t}async count(){let t=0;for await(const e of this)t++;return t}async all(t){for await(const e of this){const n=t(e);if(!(n instanceof Promise?await n:n))return!1}return!0}async some(t){for await(const e of this){const n=t(e);if(n instanceof Promise?await n:n)return!0}return!1}}function P(a){return new d(a)}function I(a){return d.fromReadableStream(a)}function $(a){return d.from(a)}const h={from:P,fromReadableStream:I,fromPromise:$,empty:()=>new d([]),of:(...a)=>new d(a),range:(a,t,e=1)=>{const n=[];for(let r=a;r<t;r+=e)n.push(r);return new d(n)},interval:(a,t)=>{const e=async function*(){let n=0;for(;!(t!=null&&t.aborted);)yield n++,await new Promise(r=>setTimeout(r,a))};return new d(e())},merge:(...a)=>a[0].merge(...a.slice(1)),combine:(...a)=>{const t=async function*(){const e=a.map(o=>o[Symbol.asyncIterator]()),n=new Array(a.length);let r=new Array(a.length).fill(!1);for(;;){const o=await Promise.all(e.map((i,u)=>i.next().then(c=>({i:u,r:c}))));let s=!0;for(const{i,r:u}of o)u.done||(n[i]=u.value,r[i]=!0,s=!1);if(s)break;r.every(i=>i)&&(yield[...n])}};return new d(t())}};function f(a,t,e=!1){const n=document.getElementById(a);if(e){n.innerHTML="";return}const r=document.createElement("div");for(r.className="stream-item",r.textContent=t,n.appendChild(r);n.children.length>10;)n.removeChild(n.firstChild)}function l(a,t,e=!1){const n=document.getElementById(a);e?n.textContent+=t+`
`:n.textContent=t,n.scrollTop=n.scrollHeight}document.getElementById("basicDemo").addEventListener("click",async()=>{const a=document.getElementById("basicDemo"),t=document.getElementById("basicStop");a.disabled=!0,t.disabled=!1,l("basicOutput",`ðŸš€ Starting basic stream processing...
`),f("basicViz",null,!0);const e=[1,2,3,4,5,6,7,8,9,10],n=h.from(e).map(s=>s*2).filter(s=>s>5).scan((s,i)=>s+i,0),r=[],o=n.observe(s=>{r.push(s),f("basicViz",s),l("basicOutput",`Processed value: ${s}`,!0)},{onComplete:()=>{l("basicOutput",`
âœ… Stream completed!
Final result: [${r.join(", ")}]`,!0),a.disabled=!1,t.disabled=!0}});t.onclick=()=>{o.unsubscribe(),l("basicOutput",`
â¹ï¸ Stream stopped by user`,!0),a.disabled=!1,t.disabled=!0}});let w=null;document.getElementById("realtimeDemo").addEventListener("click",()=>{const a=document.getElementById("realtimeDemo"),t=document.getElementById("realtimeStop");a.disabled=!0,t.disabled=!1,l("realtimeOutput",`ðŸŒŠ Starting real-time stream...
`),f("realtimeViz",null,!0);let e=0;w=h.interval(500).map(r=>({id:r,value:Math.floor(Math.random()*100),timestamp:new Date().toLocaleTimeString()})).filter(r=>r.value>30).observe(r=>{e++,f("realtimeViz",`${r.value}`),l("realtimeOutput",`[${r.timestamp}] Value: ${r.value}`,!0),e>=20&&(w.unsubscribe(),l("realtimeOutput",`
âœ… Reached 20 items, stopping...`,!0),a.disabled=!1,t.disabled=!0)}),t.onclick=()=>{w&&(w.unsubscribe(),l("realtimeOutput",`
â¹ï¸ Stream stopped by user`,!0),a.disabled=!1,t.disabled=!0)}});document.getElementById("realtimeStop").addEventListener("click",()=>{w&&w.unsubscribe()});document.getElementById("perfDemo").addEventListener("click",async()=>{const a=document.getElementById("perfDemo");a.disabled=!0,l("perfOutput",`â±ï¸ Running performance benchmark...
`);const t=1e5,e=Array.from({length:t},(c,m)=>m),n=performance.now(),o=await h.from(e).map(c=>c*2).filter(c=>c%3===0).scan((c,m)=>c+m,0).last(),s=performance.now()-n,i=performance.now();e.map(c=>c*2).filter(c=>c%3===0).reduce((c,m)=>c+m,0);const u=performance.now()-i;document.getElementById("nagareTime").textContent=s.toFixed(2),document.getElementById("jsTime").textContent=u.toFixed(2),document.getElementById("speedup").textContent=(u/s).toFixed(2)+"x",l("perfOutput",`ðŸ“Š Benchmark Results (${t.toLocaleString()} elements):

Nagare: ${s.toFixed(2)}ms
Native JS: ${u.toFixed(2)}ms
Speedup: ${(u/s).toFixed(2)}x faster

âœ… Final value: ${o==null?void 0:o.toLocaleString()}`),a.disabled=!1});let O=null;document.getElementById("mergeDemo").addEventListener("click",()=>{const a=document.getElementById("mergeDemo"),t=document.getElementById("mergeStop");a.disabled=!0,t.disabled=!1,l("mergeOutput",`ðŸ”„ Merging multiple streams...
`),f("mergeViz",null,!0);const e=h.interval(1e3).map(i=>`A${i}`).take(5),n=h.interval(1500).map(i=>`B${i}`).take(5),r=h.interval(2e3).map(i=>`C${i}`).take(5),o=e.merge(n,r);let s=0;O=o.observe(i=>{s++,f("mergeViz",i),l("mergeOutput",`Received: ${i} (item #${s})`,!0)},{onComplete:()=>{l("mergeOutput",`
âœ… All streams merged and completed!`,!0),a.disabled=!1,t.disabled=!0}}),t.onclick=()=>{O&&(O.unsubscribe(),l("mergeOutput",`
â¹ï¸ Merge stopped by user`,!0),a.disabled=!1,t.disabled=!0)}});document.getElementById("errorDemo").addEventListener("click",async()=>{const a=document.getElementById("errorDemo");a.disabled=!0,l("errorOutput",`ðŸ›¡ï¸ Testing error recovery...
`),f("errorViz",null,!0);const t=[1,2,3,4,5,6,7,8,9,10],e=h.from(t).map(r=>{if(r===5||r===7)throw new Error(`Error at value ${r}`);return r*2}).rescue(r=>(console.log("Rescued error:",r),-1)),n=[];e.observe(r=>{n.push(r);const o=r===-1;f("errorViz",o?"âŒ":r),l("errorOutput",o?`âš ï¸ Error recovered, replaced with: ${r}`:`âœ… Processed: ${r}`,!0)},{onComplete:()=>{l("errorOutput",`
âœ… Stream completed with error recovery!
Results: [${n.join(", ")}]
Errors handled: ${n.filter(r=>r===-1).length}`,!0),a.disabled=!1}})});document.getElementById("windowDemo").addEventListener("click",async()=>{const a=document.getElementById("windowDemo");a.disabled=!0,l("windowOutput",`ðŸ“ˆ Calculating rolling window statistics...
`),f("windowViz",null,!0);const t=Array.from({length:20},(o,s)=>50+Math.sin(s/2)*20+Math.random()*10),e=h.from(t).map(o=>Math.round(o)).windowedAggregate(5,"mean"),n=[];let r=0;e.observe(o=>{r++,n.push(o);const s=Math.round(o);f("windowViz",s),l("windowOutput",`Window ${r}: Average = ${s} (5-item rolling mean)`,!0)},{onComplete:()=>{const o=Math.min(...n),s=Math.max(...n),i=n.reduce((u,c)=>u+c,0)/n.length;l("windowOutput",`
âœ… Window aggregation completed!
Windows processed: ${n.length}
Min average: ${Math.round(o)}
Max average: ${Math.round(s)}
Overall average: ${Math.round(i)}`,!0),a.disabled=!1}})});window.addEventListener("DOMContentLoaded",()=>{console.log("ðŸŒŠ Nagare Demo Loaded!"),l("basicOutput","Ready to demonstrate stream processing..."),l("realtimeOutput","Ready to start real-time stream..."),l("perfOutput","Ready to run performance benchmark..."),l("mergeOutput","Ready to merge streams..."),l("errorOutput","Ready to demonstrate error recovery..."),l("windowOutput","Ready to show window aggregation...")});
