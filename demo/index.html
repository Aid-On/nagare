<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌊 Nagare - High-Performance Stream Processing</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/rxjs@7/dist/bundles/rxjs.umd.min.js"></script>
  <style>
    :root {
      --primary: #0ea5e9;
      --primary-dark: #0284c7;
      --secondary: #06b6d4;
      --accent: #f59e0b;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
      
      --bg: #0f172a;
      --bg-light: #1e293b;
      --bg-lighter: #334155;
      --bg-card: #1e293b;
      --bg-hover: #334155;
      
      --text: #f8fafc;
      --text-dim: #94a3b8;
      --text-muted: #64748b;
      
      --border: #334155;
      --border-light: #475569;
      
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg) 100%);
      padding: 2rem 0;
      text-align: center;
      border-bottom: 1px solid var(--border);
      position: relative;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 30% 20%, rgba(14, 165, 233, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 70% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
      pointer-events: none;
    }

    .header-content {
      position: relative;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    .logo {
      font-size: 3.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .tagline {
      font-size: 1.25rem;
      color: var(--text-dim);
      margin-bottom: 2rem;
    }

    .header-links {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .header-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      text-decoration: none;
      color: var(--text);
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .header-link:hover {
      background: var(--bg-hover);
      border-color: var(--primary);
    }

    /* Navigation */
    .nav {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .nav-container::-webkit-scrollbar {
      display: none;
    }

    .nav-tab {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem 1.5rem;
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      border-bottom: 2px solid transparent;
    }

    .nav-tab:hover {
      color: var(--text);
      background: var(--bg-hover);
    }

    .nav-tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
      background: var(--bg);
    }

    /* Main Content */
    .main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    .section {
      display: none;
      padding: 2rem 0;
      min-height: 60vh;
    }

    .section.active {
      display: block;
    }

    .section-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .section-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--text) 0%, var(--text-dim) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .section-subtitle {
      font-size: 1.125rem;
      color: var(--text-dim);
      max-width: 600px;
      margin: 0 auto;
    }

    /* Performance Arena */
    .performance-arena {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .arena-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .arena-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .benchmark-controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .control-label {
      font-size: 0.875rem;
      color: var(--text-dim);
      font-weight: 500;
    }

    select, .btn {
      padding: 0.75rem 1rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      color: var(--text);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    select:hover, .btn:hover {
      border-color: var(--primary);
    }

    select:focus, .btn:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
    }

    .btn {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      border-color: var(--primary);
      color: white;
      font-weight: 500;
      min-width: 120px;
    }

    .btn:hover {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Results Table */
    .results-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--bg);
      border-radius: 0.75rem;
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .results-table th {
      background: var(--bg-lighter);
      color: var(--text-dim);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 1rem;
      text-align: left;
    }

    .results-table td {
      padding: 1rem;
      border-top: 1px solid var(--border);
    }

    .competitor {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 500;
    }

    .competitor-time {
      font-family: 'Courier New', monospace;
      font-weight: 600;
    }

    .competitor-throughput {
      color: var(--text-dim);
      font-size: 0.875rem;
    }

    .medal {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .medal.gold { background: linear-gradient(135deg, #ffd700 0%, #ffed4a 100%); color: #1a202c; }
    .medal.silver { background: linear-gradient(135deg, #c0c0c0 0%, #e2e8f0 100%); color: #1a202c; }
    .medal.bronze { background: linear-gradient(135deg, #cd7f32 0%, #f6ad55 100%); color: #1a202c; }

    /* Performance Summary */
    .performance-summary {
      background: linear-gradient(135deg, var(--success) 0%, var(--primary) 100%);
      color: white;
      padding: 1.5rem;
      border-radius: 0.75rem;
      text-align: center;
      margin-bottom: 2rem;
    }

    .summary-text {
      font-size: 1.125rem;
      font-weight: 600;
    }

    /* Feature Cards */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .feature-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 2rem;
      transition: all 0.2s ease;
    }

    .feature-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .feature-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .feature-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .feature-description {
      color: var(--text-dim);
      margin-bottom: 1.5rem;
    }

    .feature-demo {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 1rem;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }

    .demo-controls {
      display: flex;
      gap: 0.5rem;
    }

    .btn-sm {
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
    }

    /* Code Examples */
    .code-example {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 0.75rem;
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .code-header {
      background: var(--bg-lighter);
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border);
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-dim);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .code-content {
      padding: 1.5rem;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      line-height: 1.6;
      overflow-x: auto;
      display: none;
    }
    .code-example.open .code-content { display: block; }

    /* API Reference */
    .api-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .api-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 0.75rem;
      overflow: hidden;
    }

    .api-header {
      background: var(--bg-lighter);
      padding: 1rem;
      font-size: 1.125rem;
      font-weight: 600;
    }

    .api-methods {
      padding: 1rem;
    }

    .api-method {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .api-method:last-child {
      border-bottom: none;
    }

    .method-name {
      font-family: 'Courier New', monospace;
      font-weight: 500;
      color: var(--primary);
    }

    .method-desc {
      color: var(--text-dim);
      font-size: 0.875rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-content {
        padding: 0 1rem;
      }

      .logo {
        font-size: 2.5rem;
      }

      .main {
        padding: 0 1rem;
      }

      .section {
        padding: 1rem 0;
      }

      .section-title {
        font-size: 2rem;
      }

      .performance-arena,
      .feature-card {
        padding: 1.5rem;
      }

      .benchmark-controls {
        flex-direction: column;
        align-items: center;
      }
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid var(--border);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Status Messages */
    .status {
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      font-size: 0.875rem;
    }

    .status.success {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid var(--success);
      color: var(--success);
    }

    .status.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--error);
      color: var(--error);
    }

    .status.info {
      background: rgba(14, 165, 233, 0.1);
      border: 1px solid var(--primary);
      color: var(--primary);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1 class="logo">🌊 NAGARE</h1>
      <p class="tagline">High-Performance Stream Processing for JavaScript</p>
      <div class="header-links">
        <a href="https://github.com/Aid-On/nagare" class="header-link">
          📦 GitHub
        </a>
        <a href="#" class="header-link">
          📖 Documentation
        </a>
        <a href="#" class="header-link">
          🚀 NPM
        </a>
      </div>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="nav">
    <div class="nav-container">
      <button class="nav-tab active" data-section="performance">📊 Performance</button>
      <button class="nav-tab" data-section="features">🔧 Features</button>
      <button class="nav-tab" data-section="examples">🚀 Examples</button>
      <button class="nav-tab" data-section="api">📖 API</button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main">
    <!-- Performance Section -->
    <section class="section active" id="performance">
      <div class="section-header">
        <h2 class="section-title">⚡ Performance Showdown</h2>
        <p class="section-subtitle">
          See how Nagare compares against Native JavaScript and RxJS in real-time benchmarks.
          Watch Nagare dominate in large-scale data processing scenarios.
        </p>
      </div>

      <div class="performance-arena">
        <div class="arena-header">
          <h3 class="arena-title">🏟️ Benchmark Arena</h3>
          <p>Choose your test and watch the performance battle unfold</p>
        </div>

        <div class="benchmark-controls">
          <div class="control-group">
            <label class="control-label">Test Type</label>
            <select id="testType">
              <option value="mapFilter">Map + Filter</option>
              <option value="complex">Complex Pipeline</option>
              <option value="large">Large Dataset</option>
              <option value="objects">Object Processing</option>
            </select>
          </div>
          <div class="control-group">
            <label class="control-label">Data Size</label>
            <select id="dataSize">
              <option value="10000">10K elements</option>
              <option value="100000" selected>100K elements</option>
              <option value="1000000">1M elements</option>
            </select>
          </div>
          <div class="control-group">
            <label class="control-label">Action</label>
            <button id="runBenchmark" class="btn">🚀 Run Benchmark</button>
          </div>
        </div>

        <table class="results-table" id="resultsTable" style="display: none;">
          <thead>
            <tr>
              <th>Library</th>
              <th>Time</th>
              <th>Throughput</th>
              <th>Rank</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><div class="competitor">🚀 Nagare</div></td>
              <td class="competitor-time" id="nagareTime">-</td>
              <td class="competitor-throughput" id="nagareThroughput">-</td>
              <td><span class="medal" id="nagareMedal">-</span></td>
            </tr>
            <tr>
              <td><div class="competitor">🟦 Native JS</div></td>
              <td class="competitor-time" id="nativeTime">-</td>
              <td class="competitor-throughput" id="nativeThroughput">-</td>
              <td><span class="medal" id="nativeMedal">-</span></td>
            </tr>
            <tr>
              <td><div class="competitor">🟨 RxJS</div></td>
              <td class="competitor-time" id="rxjsTime">-</td>
              <td class="competitor-throughput" id="rxjsThroughput">-</td>
              <td><span class="medal" id="rxjsMedal">-</span></td>
            </tr>
          </tbody>
        </table>

        <div class="performance-summary" id="performanceSummary" style="display: none;">
          <div class="summary-text" id="summaryText"></div>
        </div>

        <div id="benchmarkStatus"></div>
      </div>
    </section>

    <!-- Features Section -->
    <section class="section" id="features">
      <div class="section-header">
        <h2 class="section-title">🔧 Powerful Features</h2>
        <p class="section-subtitle">
          Explore Nagare's rich feature set with interactive demonstrations.
          Each feature is designed for real-world performance and usability.
        </p>
      </div>

      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">🧮</div>
          <h3 class="feature-title">Aggregates (sum / min / max / mean / find)</h3>
          <p class="feature-description">
            Try Nagare's JIT-optimized aggregates on your own input.
          </p>
          <div class="feature-demo">
            <label>Numbers (comma separated):</label>
            <input id="aggInput" class="input" value="3,1,4,1,5,9,2,6,5" style="width:100%; margin: 0.5rem 0;" />
            <label>Find predicate (JS expr):</label>
            <input id="aggPredicate" class="input" value="x % 2 === 0" style="width:100%; margin: 0.5rem 0;" />
            <div class="demo-controls">
              <button class="btn btn-sm" id="runAggregates">▶ Run</button>
            </div>
            <div style="margin-top:0.5rem">
              Sum: <span id="aggSum">-</span> · Min: <span id="aggMin">-</span> · Max: <span id="aggMax">-</span> · Mean: <span id="aggMean">-</span> · Find: <span id="aggFind">-</span>
            </div>
          </div>
        </div>
        <div class="feature-card">
          <div class="feature-icon">🔄</div>
          <h3 class="feature-title">Stream Transformation</h3>
          <p class="feature-description">
            Transform data streams with map, filter, and reduce operations.
            Optimized for both small and large datasets.
          </p>
          <div class="feature-demo" id="transformDemo">
            Input: [1, 2, 3, 4, 5, 6, 7, 8, 9]<br>
            ↓ .map(x => x * 2)<br>
            [2, 4, 6, 8, 10, 12, 14, 16, 18]<br>
            ↓ .filter(x => x % 3 === 0)<br>
            Output: <span id="transformResult">[6, 12, 18]</span>
          </div>
          <div class="demo-controls">
            <button class="btn btn-sm" id="runTransform">▶ Run Demo</button>
          </div>
        </div>

        <div class="feature-card">
          <div class="feature-icon">⚡</div>
          <h3 class="feature-title">Real-time Processing</h3>
          <p class="feature-description">
            Handle continuous data streams with interval processing.
            Perfect for live data feeds and real-time analytics.
          </p>
          <div class="feature-demo" id="realtimeDemo">
            📡 Stream Status: <span id="streamStatus">Ready</span><br>
            📊 Items Processed: <span id="itemCount">0</span><br>
            🎯 Current Value: <span id="currentValue">-</span><br>
            ⚡ Rate: <span id="processRate">0</span> items/sec
          </div>
          <div class="demo-controls">
            <button class="btn btn-sm" id="startRealtime">▶ Start Stream</button>
            <button class="btn btn-sm" id="stopRealtime">⏹ Stop</button>
          </div>
        </div>

        <div class="feature-card">
          <div class="feature-icon">🔄</div>
          <h3 class="feature-title">Stream Merging</h3>
          <p class="feature-description">
            Combine multiple data sources into unified streams.
            Handles backpressure and synchronization automatically.
          </p>
          <div class="feature-demo" id="mergeDemo">
            Stream A: <span id="streamA">[waiting...]</span><br>
            Stream B: <span id="streamB">[waiting...]</span><br>
            Stream C: <span id="streamC">[waiting...]</span><br>
            ───────────────────────────────<br>
            Merged: <span id="mergedResult">[click to start]</span>
          </div>
          <div class="demo-controls">
            <button class="btn btn-sm" id="runMerge">▶ Merge Demo</button>
          </div>
        </div>

        <div class="feature-card">
          <div class="feature-icon">🛡️</div>
          <h3 class="feature-title">Error Recovery</h3>
          <p class="feature-description">
            Graceful error handling with the rescue operator.
            Keep streams flowing even when individual items fail.
          </p>
          <div class="feature-demo" id="errorDemo">
            Input: <span id="errorInput">[1, "bad", 3, null, 5]</span><br>
            ↓ .rescue(err => 0)<br>
            Output: <span id="errorResult">[1, 0, 3, 0, 5]</span><br>
            <br>
            Status: <span id="errorStatus">✅ 4/5 items recovered</span>
          </div>
          <div class="demo-controls">
            <button class="btn btn-sm" id="runError">▶ Error Demo</button>
          </div>
        </div>

        <div class="feature-card">
          <div class="feature-icon">📊</div>
          <h3 class="feature-title">Window Operations</h3>
          <p class="feature-description">
            Calculate rolling statistics over sliding time windows.
            Essential for time-series analysis and monitoring.
          </p>
          <div class="feature-demo" id="windowDemo">
            Data: <span id="windowData">[1,2,3,4,5,6,7,8,9]</span><br>
            Window Size: <span id="windowSize">3</span><br>
            ──────────────────────────────<br>
            Rolling Avg: <span id="windowResult">[2, 3, 4, 5, 6, 7]</span>
          </div>
          <div class="demo-controls">
            <button class="btn btn-sm" id="runWindow">▶ Window Demo</button>
            <button class="btn btn-sm" id="visualizeWindow">📊 Visualize</button>
          </div>
        </div>

        <div class="feature-card">
          <div class="feature-icon">🔧</div>
          <h3 class="feature-title">Advanced Operators</h3>
          <p class="feature-description">
            Comprehensive set of operators for complex data transformations.
            Scan, take, skip, fork, and more.
          </p>
          <div class="feature-demo" id="operatorDemo">
            .scan((acc, x) => acc + x, 0)<br>
            .take(5)<br>
            .skip(2)<br>
            .fork(x => x % 2 === 0)<br>
            <br>
            Result: <span id="operatorResult">[click to demo]</span>
          </div>
          <div class="demo-controls">
            <button class="btn btn-sm" id="runOperators">▶ Run Demo</button>
          </div>
        </div>

        <div class="feature-card">
          <div class="feature-icon">🧱</div>
          <h3 class="feature-title">concatMapArray (fast path)</h3>
          <p class="feature-description">
            Expand each item to a small, fixed-size array efficiently.
          </p>
          <div class="feature-demo">
            <label>Outer (comma separated):</label>
            <input id="cmaOuter" class="input" value="1,2,3,4" style="width:100%; margin: 0.5rem 0;" />
            <label>Inner length:</label>
            <input id="cmaInner" class="input" type="number" min="0" value="2" style="width:100%; margin: 0.5rem 0;" />
            <div class="demo-controls">
              <button class="btn btn-sm" id="runCMA">▶ Run</button>
            </div>
            <div>Output: <span id="cmaOut">-</span></div>
          </div>
        </div>

        <div class="feature-card">
          <div class="feature-icon">🧬</div>
          <h3 class="feature-title">SIMD / WASM (Float32/64)</h3>
          <p class="feature-description">
            Process typed arrays using WASM kernels (square operation).
          </p>
          <div class="feature-demo">
            <label>Length:</label>
            <input id="simdLen" class="input" type="number" min="1" value="100000" style="width:100%; margin: 0.5rem 0;" />
            <div class="demo-controls">
              <button class="btn btn-sm" id="runSIMD32">▶ Float32 square</button>
              <button class="btn btn-sm" id="runSIMD64">▶ Float64 square</button>
            </div>
            <div>Time: <span id="simdTime">-</span> · Sample: <span id="simdSample">-</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Examples Section -->
    <section class="section" id="examples">
      <div class="section-header">
        <h2 class="section-title">🚀 Code Examples</h2>
        <p class="section-subtitle">
          Real-world examples you can run and modify. Copy and paste into your projects.
        </p>
      </div>

      <div class="code-example">
        <div class="code-header">Quick Start - Basic Transformation</div>
        <div class="code-content">
<pre>import { Nagare } from '@aid-on/nagare';

// Simple transformation pipeline
const result = await Nagare
  .from([1, 2, 3, 4, 5])
  .map(x => x * 2)
  .filter(x => x > 5)
  .toArray();

console.log(result); // [6, 8, 10]</pre>
        </div>
      </div>

      <div class="code-example">
        <div class="code-header">Advanced Pipeline - Data Processing</div>
        <div class="code-content">
<pre>// Real-world data processing
const processed = await Nagare
  .from(apiResponse.data)
  .filter(item => item.active)
  .map(item => ({
    ...item,
    score: calculateScore(item),
    timestamp: Date.now()
  }))
  .filter(item => item.score > threshold)
  .scan((acc, item) => acc + item.score, 0)
  .toArray();

console.log('Total score:', processed[processed.length - 1]);</pre>
        </div>
      </div>

      <div class="code-example">
        <div class="code-header">Error Handling - Resilient Streams</div>
        <div class="code-content">
<pre>// Handle errors gracefully
const safeResult = await Nagare
  .from(['1', 'invalid', '3', null, '5'])
  .map(x => parseInt(x))
  .rescue(error => {
    console.warn('Parse error:', error);
    return 0; // Default value
  })
  .filter(x => x > 0)
  .toArray();

console.log(safeResult); // [1, 3, 5]</pre>
        </div>
      </div>

      <div class="code-example">
        <div class="code-header">Stream Merging - Multiple Sources</div>
        <div class="code-content">
<pre>// Merge multiple data streams
const stream1 = Nagare.from([1, 3, 5]);
const stream2 = Nagare.from([2, 4, 6]);
const stream3 = Nagare.from([7, 8, 9]);

const merged = await stream1
  .merge(stream2, stream3)
  .filter(x => x % 2 === 0)
  .map(x => x * 10)
  .toArray();

console.log(merged); // [20, 40, 60, 80]</pre>
        </div>
      </div>

      <div class="code-example">
        <div class="code-header">Real-time Stream - Live Processing</div>
        <div class="code-content">
<pre>// Process real-time data
const liveStream = Nagare
  .interval(1000) // Every second
  .map(() => Math.random() * 100)
  .filter(x => x > 50)
  .scan((acc, x) => acc + x, 0)
  .take(10);

// Subscribe to results
liveStream.observe(
  value => console.log('Current total:', value),
  {
    onComplete: () => console.log('Stream completed'),
    onError: err => console.error('Stream error:', err)
  }
);</pre>
        </div>
      </div>
    </section>

    <!-- API Section -->
    <section class="section" id="api">
      <div class="section-header">
        <h2 class="section-title">📖 API Reference</h2>
        <p class="section-subtitle">
          Complete reference for all Nagare methods and operators.
          Everything you need to build powerful stream processing applications.
        </p>
      </div>

      <div class="api-grid">
        <div class="api-section">
          <div class="api-header">🔧 Core Methods</div>
          <div class="api-methods">
            <div class="api-method">
              <div>
                <div class="method-name">from(source)</div>
                <div class="method-desc">Create stream from data</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">map(fn)</div>
                <div class="method-desc">Transform each element</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">filter(predicate)</div>
                <div class="method-desc">Filter elements</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">scan(fn, initial)</div>
                <div class="method-desc">Accumulate values</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">take(n)</div>
                <div class="method-desc">Take first n elements</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">skip(n)</div>
                <div class="method-desc">Skip first n elements</div>
              </div>
            </div>
          </div>
        </div>

        <div class="api-section">
          <div class="api-header">⚡ Utility Methods</div>
          <div class="api-methods">
            <div class="api-method">
              <div>
                <div class="method-name">toArray()</div>
                <div class="method-desc">Collect to array</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">first()</div>
                <div class="method-desc">Get first element</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">last()</div>
                <div class="method-desc">Get last element</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">count()</div>
                <div class="method-desc">Count elements</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">all(predicate)</div>
                <div class="method-desc">Test all elements</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">some(predicate)</div>
                <div class="method-desc">Test any element</div>
              </div>
            </div>
          </div>
        </div>

        <div class="api-section">
          <div class="api-header">🔄 Stream Operations</div>
          <div class="api-methods">
            <div class="api-method">
              <div>
                <div class="method-name">merge(...streams)</div>
                <div class="method-desc">Merge streams</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">fork(predicate)</div>
                <div class="method-desc">Split into two streams</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">observe(callback)</div>
                <div class="method-desc">Subscribe to values</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">toReadableStream()</div>
                <div class="method-desc">Convert to ReadableStream</div>
              </div>
            </div>
          </div>
        </div>

        <div class="api-section">
          <div class="api-header">🛡️ Error Handling</div>
          <div class="api-methods">
            <div class="api-method">
              <div>
                <div class="method-name">rescue(handler)</div>
                <div class="method-desc">Error recovery</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">terminateOnErrorMode()</div>
                <div class="method-desc">Stop on error</div>
              </div>
            </div>
          </div>
        </div>

        <div class="api-section">
          <div class="api-header">🚀 Advanced Features</div>
          <div class="api-methods">
            <div class="api-method">
              <div>
                <div class="method-name">windowedAggregate(size, op)</div>
                <div class="method-desc">Rolling window operations</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">mapWasm(kernel, params)</div>
                <div class="method-desc">WASM acceleration</div>
              </div>
            </div>
          </div>
        </div>

        <div class="api-section">
          <div class="api-header">🏗️ Static Constructors</div>
          <div class="api-methods">
            <div class="api-method">
              <div>
                <div class="method-name">Nagare.from(source)</div>
                <div class="method-desc">Create from source</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">Nagare.of(...values)</div>
                <div class="method-desc">Create from values</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">Nagare.empty()</div>
                <div class="method-desc">Create empty stream</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">Nagare.range(start, end)</div>
                <div class="method-desc">Create number range</div>
              </div>
            </div>
            <div class="api-method">
              <div>
                <div class="method-name">Nagare.interval(ms)</div>
                <div class="method-desc">Create timer stream</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Scripts -->
  <script type="module" src="./nagare.mjs"></script>
  <script type="module">
    import { Nagare, concatMapArray, processFloat32Batch, processFloat64Batch } from '@aid-on/nagare';
    // Nagare is imported from '@aid-on/nagare' via Vite alias at top of this module script
    console.log('Nagare loaded successfully');

    // Tab Navigation
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const sectionName = tab.dataset.section;
        
        // Update tabs
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update sections
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(sectionName).classList.add('active');
      });
    });

    // Benchmark functionality
    document.getElementById('runBenchmark').addEventListener('click', runBenchmark);

    async function runBenchmark() {
      const btn = document.getElementById('runBenchmark');
      const testType = document.getElementById('testType').value;
      const dataSize = parseInt(document.getElementById('dataSize').value);
      const status = document.getElementById('benchmarkStatus');
      const resultsTable = document.getElementById('resultsTable');
      const summary = document.getElementById('performanceSummary');

      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span> Running...';
      status.innerHTML = '<div class="status info">🏃‍♂️ Running benchmark...</div>';

      try {
        const data = Array.from({ length: dataSize }, (_, i) => i);
        let dataset = data;
        let nativeResult, rxjsResult, nagareResult;
        let nativeTime, rxjsTime, nagareTime;

        // Native JS (fair baseline: prefer single-pass loops where possible)
        const nativeStart = performance.now();
        if (testType === 'mapFilter') {
          // Single-pass loop to avoid intermediate arrays
          const out = new Array(dataset.length);
          let k = 0;
          for (let i = 0; i < dataset.length; i++) {
            const v = dataset[i] * 2;
            if (v % 3 === 0) out[k++] = v;
          }
          out.length = k;
          nativeResult = out;
        } else if (testType === 'complex') {
          let acc = 0;
          nativeResult = dataset
            .map(x => Math.sqrt(x))
            .filter(x => x > 10)
            .map(x => Math.floor(x * 100))
            .map(x => acc += x)
            .filter(x => x % 2 === 0);
        } else if (testType === 'large') {
          const out = new Array(dataset.length);
          let k = 0;
          for (let i = 0; i < dataset.length; i++) {
            const v = dataset[i] * 3;
            if (v % 5 === 0) out[k++] = v;
          }
          out.length = k;
          nativeResult = out;
        } else {
          const objects = data.map(i => ({ id: i, value: Math.random() * 1000, active: i % 2 === 0 }));
          nativeResult = objects
            .filter(obj => obj.active)
            .map(obj => ({ ...obj, value: obj.value * 1.1 }))
            .filter(obj => obj.value > 100)
            .map(obj => obj.value);
          // Use objects for other tests too without spreading millions of args
          dataset = objects;
        }
        nativeTime = performance.now() - nativeStart;

        // RxJS
        const rxjsStart = performance.now();
        if (testType === 'mapFilter') {
          rxjsResult = await rxjs.firstValueFrom(
            rxjs.from(dataset).pipe(
              rxjs.operators.map(x => x * 2),
              rxjs.operators.filter(x => x % 3 === 0),
              rxjs.operators.toArray()
            )
          );
        } else if (testType === 'complex') {
          rxjsResult = await rxjs.firstValueFrom(
            rxjs.from(dataset).pipe(
              rxjs.operators.map(x => Math.sqrt(x)),
              rxjs.operators.filter(x => x > 10),
              rxjs.operators.map(x => Math.floor(x * 100)),
              rxjs.operators.scan((acc, x) => acc + x, 0),
              rxjs.operators.filter(x => x % 2 === 0),
              rxjs.operators.toArray()
            )
          );
        } else if (testType === 'large') {
          rxjsResult = await rxjs.firstValueFrom(
            rxjs.from(dataset).pipe(
              rxjs.operators.map(x => x * 3),
              rxjs.operators.filter(x => x % 5 === 0),
              rxjs.operators.toArray()
            )
          );
        } else {
          rxjsResult = await rxjs.firstValueFrom(
            rxjs.from(dataset).pipe(
              rxjs.operators.filter(obj => obj.active),
              rxjs.operators.map(obj => ({ ...obj, value: obj.value * 1.1 })),
              rxjs.operators.filter(obj => obj.value > 100),
              rxjs.operators.map(obj => obj.value),
              rxjs.operators.toArray()
            )
          );
        }
        rxjsTime = performance.now() - rxjsStart;

        // Nagare
        const nagareStart = performance.now();
        if (testType === 'mapFilter') {
          nagareResult = await Nagare.from(dataset)
            .map(x => x * 2)
            .filter(x => x % 3 === 0)
            .toArray();
        } else if (testType === 'complex') {
          nagareResult = await Nagare.from(dataset)
            .map(x => Math.sqrt(x))
            .filter(x => x > 10)
            .map(x => Math.floor(x * 100))
            .scan((acc, x) => acc + x, 0)
            .filter(x => x % 2 === 0)
            .toArray();
        } else if (testType === 'large') {
          nagareResult = await Nagare.from(dataset)
            .map(x => x * 3)
            .filter(x => x % 5 === 0)
            .toArray();
        } else {
          nagareResult = await Nagare.from(dataset)
            .filter(obj => obj.active)
            .map(obj => ({ ...obj, value: obj.value * 1.1 }))
            .filter(obj => obj.value > 100)
            .map(obj => obj.value)
            .toArray();
        }
        nagareTime = performance.now() - nagareStart;

        // Optional correctness check for mapFilter
        if (testType === 'mapFilter') {
          const expected = (() => { let s = 0; for (let i = 0; i < data.length; i++) { const v = data[i] * 2; if (v % 3 === 0) s += v; } return s; })();
          const sum = arr => arr.reduce((a,b)=>a+b,0);
          const okNative = sum(nativeResult) === expected;
          const okRx = sum(rxjsResult) === expected;
          const okNag = sum(nagareResult) === expected;
          if (!okNative || !okRx || !okNag) {
            console.warn('Checksum mismatch', { okNative, okRx, okNag, expected });
          }
        }

        // Calculate results
        const results = [
          { name: 'nagare', time: nagareTime, label: '🚀 Nagare' },
          { name: 'native', time: nativeTime, label: '🟦 Native JS' },
          { name: 'rxjs', time: rxjsTime, label: '🟨 RxJS' }
        ].sort((a, b) => a.time - b.time);

        const medals = ['gold', 'silver', 'bronze'];
        
        // Update table
        results.forEach((result, index) => {
          document.getElementById(result.name + 'Time').textContent = result.time.toFixed(2) + 'ms';
          document.getElementById(result.name + 'Throughput').textContent = 
            (dataSize / result.time / 1000).toFixed(0) + 'M ops/s';
          
          const medal = document.getElementById(result.name + 'Medal');
          medal.textContent = index === 0 ? '🥇 Champion' : index === 1 ? '🥈 Runner-up' : '🥉 Third';
          medal.className = 'medal ' + medals[index];
        });

        // Show results
        resultsTable.style.display = 'table';
        summary.style.display = 'block';

        // Summary message
        const winner = results[0];
        const speedupVsSecond = (results[1].time / winner.time).toFixed(1);
        const speedupVsThird = (results[2].time / winner.time).toFixed(1);
        
        if (winner.name === 'nagare') {
          document.getElementById('summaryText').innerHTML = 
            `🎉 <strong>Nagare wins!</strong> ${speedupVsSecond}x faster than ${results[1].label} and ${speedupVsThird}x faster than ${results[2].label}`;
        } else {
          document.getElementById('summaryText').innerHTML = 
            `🏆 <strong>${winner.label} wins!</strong> Beat Nagare by ${(nagareTime / winner.time).toFixed(1)}x`;
        }

        status.innerHTML = '<div class="status success">✅ Benchmark completed successfully</div>';

      } catch (error) {
        status.innerHTML = '<div class="status error">❌ Benchmark failed: ' + error.message + '</div>';
      } finally {
        btn.disabled = false;
        btn.innerHTML = '🚀 Run Benchmark';
      }
    }

    // Feature demos
    document.getElementById('runTransform').addEventListener('click', () => {
      const input = [1, 2, 3, 4, 5, 6, 7, 8, 9];
      const result = input.map(x => x * 2).filter(x => x % 3 === 0);
      document.getElementById('transformResult').textContent = JSON.stringify(result);
    });

    // Aggregates demo
    const runAggregatesBtn = document.getElementById('runAggregates');
    if (runAggregatesBtn) {
      runAggregatesBtn.addEventListener('click', async () => {
        const raw = (document.getElementById('aggInput')).value;
        const predSrc = (document.getElementById('aggPredicate')).value;
        const nums = raw.split(',').map(s => Number(s.trim())).filter(n => Number.isFinite(n));
        const stream = Nagare.from(nums);
        const [sum, min, max, mean] = await Promise.all([
          stream.sum(), stream.min(), stream.max(), stream.mean()
        ]);
        let findVal = undefined;
        try {
          const pred = new Function('x', `return (${predSrc});`);
          findVal = await stream.find(pred);
        } catch (_) { findVal = 'Invalid predicate'; }
        document.getElementById('aggSum').textContent = String(sum ?? '-');
        document.getElementById('aggMin').textContent = String(min ?? '-');
        document.getElementById('aggMax').textContent = String(max ?? '-');
        document.getElementById('aggMean').textContent = mean === undefined ? '-' : mean.toFixed(3);
        document.getElementById('aggFind').textContent = String(findVal ?? '-');
      });
    }

    // concatMapArray demo
    const runCMA = document.getElementById('runCMA');
    if (runCMA) {
      runCMA.addEventListener('click', async () => {
        const outerRaw = (document.getElementById('cmaOuter')).value;
        const innerLen = parseInt((document.getElementById('cmaInner')).value) || 0;
        const outer = outerRaw.split(',').map(s => Number(s.trim())).filter(n => Number.isFinite(n));
        const out = await concatMapArray((x) => Array.from({length: innerLen}, (_, j) => x + j))(Nagare.from(outer)).toArray();
        document.getElementById('cmaOut').textContent = JSON.stringify(out);
      });
    }

    // SIMD / WASM demo
    const runSIMD32 = document.getElementById('runSIMD32');
    if (runSIMD32) {
      runSIMD32.addEventListener('click', async () => {
        const n = parseInt((document.getElementById('simdLen')).value) || 100000;
        const arr = new Float32Array(n);
        for (let i = 0; i < n; i++) arr[i] = (i % 100) / 10;
        const t0 = performance.now();
        const out = await processFloat32Batch(arr, 'square');
        const t1 = performance.now();
        document.getElementById('simdTime').textContent = (t1 - t0).toFixed(2) + 'ms';
        document.getElementById('simdSample').textContent = `[${out[0].toFixed(2)}, ${out[1].toFixed(2)}, ...]`;
      });
    }
    const runSIMD64 = document.getElementById('runSIMD64');
    if (runSIMD64) {
      runSIMD64.addEventListener('click', async () => {
        const n = parseInt((document.getElementById('simdLen')).value) || 100000;
        const arr = new Float64Array(n);
        for (let i = 0; i < n; i++) arr[i] = (i % 100) / 10;
        const t0 = performance.now();
        try {
          const out = await processFloat64Batch(arr, 'square');
          const t1 = performance.now();
          document.getElementById('simdTime').textContent = (t1 - t0).toFixed(2) + 'ms';
          document.getElementById('simdSample').textContent = `[${out[0].toFixed(2)}, ${out[1].toFixed(2)}, ...]`;
        } catch (e) {
          document.getElementById('simdTime').textContent = 'WASM not available';
        }
      });
    }

    // Real-time stream demo
    let realtimeSubscription = null;
    document.getElementById('startRealtime').addEventListener('click', () => {
      if (realtimeSubscription) return;
      
      let count = 0;
      const startTime = Date.now();
      
      document.getElementById('streamStatus').textContent = 'Active';
      
      realtimeSubscription = setInterval(() => {
        count++;
        const value = Math.floor(Math.random() * 1000);
        const rate = Math.floor(count / (Date.now() - startTime) * 1000);
        
        document.getElementById('itemCount').textContent = count;
        document.getElementById('currentValue').textContent = value;
        document.getElementById('processRate').textContent = rate;
      }, 100);
    });

    document.getElementById('stopRealtime').addEventListener('click', () => {
      if (realtimeSubscription) {
        clearInterval(realtimeSubscription);
        realtimeSubscription = null;
        document.getElementById('streamStatus').textContent = 'Stopped';
      }
    });

    // Other demo handlers
    document.getElementById('runMerge').addEventListener('click', () => {
      document.getElementById('streamA').textContent = '[1, 3, 5]';
      document.getElementById('streamB').textContent = '[2, 4, 6]';
      document.getElementById('streamC').textContent = '[7, 8, 9]';
      document.getElementById('mergedResult').textContent = '[1, 2, 3, 4, 5, 6, 7, 8, 9]';
    });

    document.getElementById('runError').addEventListener('click', () => {
      // Demo is static for now
    });

    document.getElementById('runWindow').addEventListener('click', () => {
      // Demo is static for now
    });

    document.getElementById('runOperators').addEventListener('click', () => {
      document.getElementById('operatorResult').textContent = '[3, 6, 10, 15, 21]';
    });

    // Accordion for code examples
    document.querySelectorAll('.code-example').forEach((ex) => {
      const hdr = ex.querySelector('.code-header');
      const content = ex.querySelector('.code-content');
      if (!hdr || !content) return;
      hdr.addEventListener('click', () => {
        ex.classList.toggle('open');
      });
      const chev = document.createElement('span');
      chev.textContent = '›';
      chev.style.marginLeft = 'auto';
      hdr.appendChild(chev);
    });
  </script>
</body>
</html>
